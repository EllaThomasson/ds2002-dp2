from pymongo import MongoClient
import os
import json

MONGOPASS = os.getenv('MONGOPASS')
uri = "mongodb+srv://cluster0.pnxzwgz.mongodb.net/"
client = MongoClient(uri, username='nmagee', password=MONGOPASS, connectTimeoutMS=200, retryWrites=True)
# specify a database
db = client.ztx5bd
# specify a collection
collection = db.project

path = "data"

successful_imports = 0
failed_imports = 0
corrupted_files = 0

def insert_data(file_data):
    try:
        if isinstance(file_data, list):
            collection.insert_many(file_data)
        else:
            collection.insert_one(file_data)
        return True
    except Exception as e:
        print(f"Error inserting data: {e}")
        return False

for (root, dirs, files) in os.walk(path):
    for filename in files:
        filepath = os.path.join(root, filename)
        try:
            with open(filepath, 'r') as file:
                try:
                    file_data = json.load(file)
                    if insert_data(file_data):
                        successful_imports += 1
                    else:
                        failed_imports += 1
                except Exception as e:
                    print(f"Error reading file {filepath}: {e}")
                    corrupted_files += 1
        except IOError as e:
            print(f"Error opening file {filepath}: {e}")
            corrupted_files += 1

print(f"Number of successfully imported documents: {successful_imports}")
print(f"Number of documents that could not be imported: {failed_imports}")
print(f"Number of corrupted documents: {corrupted_files}")




